{% extends 'base_user.html.twig' %}

{% block title %}détails NDF{% endblock %}


{% block body %}

  <div class="container-fluid">
        <div style = "margin-left: auto ; margin-right: auto ; max-width : 900px;">
            <p class="display-6 no-wrap text-center mb-5">NDF {{ expenseReport.code }}</p>
            <div class=" d-flex justify-content-center text-center align-center">
                <div class="card" style="width: 18rem;">
                    <ul class="list-group list-group-flush">
                       <li class="list-group-item">
                            {% if expenseReport.comfirm == true %}
                                <th>comfirmer</th>
                            {% else %}
                                  <th>pas comfirmer</th>
                            {% endif %}
                        </li>
                        <li class="list-group-item"> {{expenseReport.getDate().format('d/m/y h:i')}}  </li>
                        {% if is_granted('ROLE_TRESO') %}
                            <li class="list-group-item">Client : <a href="/customer/show/{{ expenseReport.getCustomer().getId() }}" class="card-link"> {{expenseReport.getCustomer().getName()}} </a> </li>
                            <li class="list-group-item">Transaction : {% if expenseReport.getTransaction() != null %}<a href="/transaction/show/{{ expenseReport.transaction.getId() }}" class="card-link"> {{expenseReport.getTransaction().getCode()}} </a>{% endif %}</li>
                       {% endif %}
                      
                    </ul>
                    <div class="card-body">
                     {% if is_granted('ROLE_TRESO') or  expenseReport.comfirm != true %}
                        <a href="/expenseReport/edit/{{ expenseReport.getId()}}" class="card-link"><i class="fa-solid fa-pen-to-square"></i></a>
                        <a href="/expenseReport/delete/{{ expenseReport.getId()}}" class="card-link"><i class="fa-solid fa-trash-can"></i></a>
                        {% if is_granted('ROLE_TRESO') %}
                            <a href="/expenseReport/" class="card-link"><i class="fa-solid fa-list"></i></a>
                        {% endif %}
                    {% endif %}
                    </div>
                </div>
            </div>
            <table class="table table-striped">
                <p class="display-6 no-wrap text-center mb-5">Ligne des trajets</p>
                <thead>
                    <tr>
                        <th scope="col">Date</th>
                        <th scope="col">Départ</th>
                        <th scope="col">Arrivée</th>
                         <th scope="col">Distance</th>
                          <th scope="col">Moyen de transport</th>
                        <th scope="col">Montant</th>
                         {% if is_granted('ROLE_TRESO') or  expenseReport.comfirm != true %}
                            <th scope="col">Modifié</th>
                            <th scope="col">Supprimé</th>
                        {% endif %}

                    </tr>
                </thead>

                <tbody> 
                {% set totalAmount = 0 %}
                {% for expenseReportRouteLine in expenseReport.expenseReportRouteLines %} 
                    <tr>
                        <td>{{expenseReportRouteLine.date.format('d/m/y hh:ii')}} </td>
                        <td> {% if expenseReportRouteLine.repayGrid %} {{expenseReportRouteLine.repayGrid.start }} {% else %} {{expenseReportRouteLine.start}} {% endif %}</td>
                        <td> {% if expenseReportRouteLine.repayGrid %} {{expenseReportRouteLine.repayGrid.end }} {% else %} {{expenseReportRouteLine.end}} {% endif %}</td>
                        <td> {% if expenseReportRouteLine.repayGrid %} {{expenseReportRouteLine.repayGrid.distance }} {% else %} {{expenseReportRouteLine.distance}} {% endif %}</td>
                        <td> {% if expenseReportRouteLine.repayGrid %} {{expenseReportRouteLine.repayGrid.travelMean }} {% else %} {{expenseReportRouteLine.travelMeans}} {% endif %}</td>
                        <td> {% if expenseReportRouteLine.repayGrid %} {{expenseReportRouteLine.repayGrid.amount }} € {% else %} {{expenseReportRouteLine.amount}} €{% endif %}</td>
                        {% if expenseReportRouteLine.repayGrid %} {% set totalAmount = totalAmount + expenseReportRouteLine.repayGrid.amount %} {% else %}  {% set totalAmount = totalAmount + expenseReportRouteLine.amount %}  {% endif %}
                         {% if is_granted('ROLE_TRESO') or  expenseReport.comfirm != true %}
                        <td><a href="/expenseReportRouteLine/edit/{{expenseReport.id}}/{{ expenseReportRouteLine.getId()}}" class="card-link"><i class="fa-solid fa-pen-to-square"></i></a></td>
                        <td><a href="/expenseReportRouteLine/delete/{{ expenseReportRouteLine.getId()}}" class="card-link"><i class="fa-solid fa-trash-can"></i></a></td>
                        {% endif %}
                    </tr>
                {% endfor %}
                </tbody>
                <tfoot>
                    <tr> 
                        <th> </th>
                        <th> </th>
                        <th> </th>
                        <th> </th>
                        <th></th>
                        <th>{{ totalAmount }} € </th>
                        <th> </th>
                        <th> </th>
                    </tr>
                </tfoot>
            </table>
             {% if   expenseReport.comfirm != true %}
                <div class="text-center">
                    <a href="/expenseReportRouteLine/new/{{ expenseReport.id }}" ><button class="btn btn-success mt-3 mb-3" type="submit" name="show">{{ button_label|default('Ajouter une ligne ') }}<i class = "fa text-light fa-plus-square me-2"></i></button></a>
                </div>
            {% endif %}
            <table class="table table-striped">
                <p class="display-6 no-wrap text-center mb-5">Ligne de frais</p>
                <thead>
                    <tr>
                        <th scope="col">Date </th>
                        <th scope="col">Objet</th>
                         <th scope="col">Montant</th>
                        <th scope="col">Document</th>
                        {% if is_granted('ROLE_TRESO') or expenseReport.comfirm != true %}
                            <th scope="col">Modifié</th>
                            <th scope="col">Suprimé</th>
                        {% endif %}
                    </tr>
                </thead>

                <tbody>
                {% for expenseReportLine in expenseReport.expenseReportLines %} 
                    <tr>
                        <td>{% if expenseReportLine.date is  not null %}{{expenseReportLine.date.format('d/m/y')}} {% endif %} </td>
                        <td>{{expenseReportLine.object}} </td>
                        <td>{{expenseReportLine.amount}} €</td>
                        <td><a href="/expenseReportLine/download/{{ expenseReportLine.getId()}}" class="card-link"><i class="fa-sharp fa-solid fa-file"></i></a></td>
                        {% if is_granted('ROLE_TRESO') or  expenseReport.comfirm != true  %}
                            <td><a href="/expenseReportLine/edit/{{expenseReport.id}}/{{ expenseReportLine.getId()}}" class="card-link"><i class="fa-solid fa-pen-to-square"></i></a></td>
                            <td><a href="/expenseReportLine/delete/{{ expenseReportLine.getId()}}" class="card-link"><i class="fa-solid fa-trash-can"></i></a></td>
                        {% endif %}
                    </tr>
                {% endfor %}
                </tbody>
            </table>
            {% if   expenseReport.comfirm != true %}
                <div class="text-center">
                    <a href="/expenseReportLine/new/{{ expenseReport.id }}"><button class="btn btn-success mt-3 mb-3" type="submit" name="show">{{ button_label|default('Ajouter une ligne ') }}<i class = "fa text-light fa-plus-square me-2"></i></button></a>
                </div>
            {% endif %}
           
        </div>
    </div>


{% endblock %}

